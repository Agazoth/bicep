{
  "context": "resources",
  "prefix": "arm-app-gateway",
  "description": "Application Gateway",
  "resources": [
    {
      "type": "Microsoft.Network/applicationGateways",
      "apiVersion": "2019-11-01",
      "name": "${1:applicationGatewayName}",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[resourceId('Microsoft.Network/virtualNetworks', '${2:virtualNetwork1}')]",
        "[resourceId('Microsoft.Network/publicIPAddresses', '${3:publicIPAddress1}')]"
      ],
      "properties": {
        "sku": {
          "name": "${4|Standard_Small,Standard_Medium,Standard_Large,WAF_Medium,WAF_Large,Standard_v2,WAF_v2|}",
          "tier": "${5|Standard,WAF,Standard_v2,WAF_v2|}",
          "capacity": "2"
        },
        "gatewayIPConfigurations": [
          {
            "name": "${6:appGatewayIpConfig}",
            "properties": {
              "subnet": {
                "id": "[resourceId('Microsoft.Network/virtualNetworks/subnets', '${2:virtualNetwork1}', 'Subnet-1')]"
              }
            }
          }
        ],
        "frontendIPConfigurations": [
          {
            "name": "${7:appGatewayFrontendIP}",
            "properties": {
              "publicIPAddress": {
                "id": "[resourceId('Microsoft.Network/publicIPAddresses', '${3:publicIPAddress1}')]"
              }
            }
          }
        ],
        "frontendPorts": [
          {
            "name": "${8:appGatewayFrontendPort}",
            "properties": {
              "port": "${9:80}"
            }
          }
        ],
        "backendAddressPools": [
          {
            "name": "${10:appGatewayBackendPool}",
            "properties": {}
          }
        ],
        "backendHttpSettingsCollection": [
          {
            "name": "${13:appGatewayBackendHttpSettings}",
            "properties": {
              "port": "${14:80}",
              "protocol": "${15|Http,Https|}",
              "cookieBasedAffinity": "Disabled"
            }
          }
        ],
        "httpListeners": [
          {
            "name": "${16:appGatewayHttpListener}",
            "properties": {
              "frontendIPConfiguration": {
                "id": "[resourceId('Microsoft.Network/applicationGateways/frontendIPConfigurations', '${1:applicationGatewayName}', '${7:appGatewayFrontendIP}')]"
              },
              "frontendPort": {
                "id": "[resourceId('Microsoft.Network/applicationGateways/frontendPorts',  '${1:applicationGatewayName}', '${8:appGatewayFrontendPort}')]"
              },
              "protocol": "${17|Http,Https|}",
              "sslCertificate": "null"
            }
          }
        ],
        "requestRoutingRules": [
          {
            "name": "${18:ruleName}",
            "properties": {
              "ruleType": "${19|Basic,PathBasedRouting|}",
              "httpListener": {
                "id": "[resourceId('Microsoft.Network/applicationGateways/httpListeners', '${1:applicationGatewayName}', '${16:appGatewayHttpListener}')]"
              },
              "backendAddressPool": {
                "id": "[resourceId('Microsoft.Network/applicationGateways/backendAddressPools', '${1:applicationGatewayName}', '${10:appGatewayBackendPool}')]"
              },
              "backendHttpSettings": {
                "id": "[resourceId('Microsoft.Network/applicationGateways/backendHttpSettingsCollection', '${1:applicationGatewayName}', '${13:appGatewayBackendHttpSettings}')]"
              }
            }
          }
        ]
      }
    }
  ]
}